<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin manangement</title>
    <link rel="stylesheet" href="/css/admin_management.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"> -->

<body>
    <div class="allpage">
        <!-- START of Nav bar. -->
        <header>
            <div class="header-content">
                <div class="logo">asap</div>
                <nav class="navigation">
                    <a href="/web-page" class="nav-link">Home</a>
                    <a href="#" class="nav-link">Product</a>
                    <a href="/team-page" class="nav-link">Team</a>
                </nav>
                <div class="social-icons">
                    <nav class="nav">
                        <a href="/search-page" class="nav-link"><img
                                src="https://cdn.builder.io/api/v1/image/assets/TEMP/74d610171b49cc3b18b456fe06d02bff2a8f09126ee10249b3afcbc71e046e51?apiKey=17a27039907c49e7b5a6c90c007a4cde&"
                                alt="" class="social-icon" /></a>
                        <a href="/task-bar" class="nav-link"><img
                                src="https://cdn.builder.io/api/v1/image/assets/TEMP/d8ac2af4fe98d3962e7216f1d3a4f909c949da16f51206d4e6f2839c71acdc86?apiKey=17a27039907c49e7b5a6c90c007a4cde&"
                                alt="" class="social-icon" /></a>
                        <a href="#" class="nav-link"><img
                                src="https://cdn.builder.io/api/v1/image/assets/TEMP/8f0501680077f26e72f80f48966516db3764b49ea97d0706b2943c6ac5ed015b?apiKey=17a27039907c49e7b5a6c90c007a4cde&"
                                alt="" class="social-icon-large" /></a>
                    </nav>
                </div>
            </div>
        </header>
        <!-- END of Nav bar. -->

        <!-- START of content -->
        <main>
            <!-- START of part1 -->
            <div class="part1">
                <h2>Adminstration</h2>
            </div>
            <!-- END of part1 -->

            <!-- START of part2 -->
            <div class="part2">
                <!-- START of add-detail -->
                <div class="add-detail">
                    <h3>Manage User</h3>
                    <p>Administer and oversee user accounts and privileges within the platform.</p>
                </div>
                <!-- END of add-detail -->

                <!-- START of popup -->
                <div class="popup" id="popup-1">
                    <div class="overlay"></div>
                    <!-- START of content in popup -->
                    <div class="content">
                        <div class="triangle"></div>
                        <!-- START of info of content-->
                        <div class="info" id="infoid">
                            <form action="http://localhost:8000/add_admin" method="post" class="form-card">
                                <div class="card_header">
                                    <h1 class="form_heading">Add New Admin</h1>
                                </div>
                                <div class="field">
                                    <label for="username">Username</label>
                                    <input class="input" name="username" type="text" id="username"
                                        placeholder="Enter your username" title="Required Username" required>
                                </div>
                                <div class="field">
                                    <label for="First-name">First Name</label>
                                    <input class="input" name="firstName" type="text" id="First-name"
                                        placeholder="Enter your first name" title="Required first name" required>
                                </div>
                                <div class="field">
                                    <label for="Last-name">Last Name</label>
                                    <input class="input" name="lastName" type="text" id="Last-name"
                                        placeholder="Enter your last name" title="Required last name" required>
                                </div>
                                <div class="field">
                                    <label for="Position">Position</label>
                                    <input class="input" name="position" type="text" id="Position"
                                        placeholder="Enter your position" title="Required position" required>
                                </div>
                                <div class="field">
                                    <label for="phone-number">Phone Number</label>
                                    <input class="input" name="phoneNumber" type="text" id="phone-number"
                                        placeholder="Enter your phone number" title="Required phone number" required>
                                </div>
                                <div class="field">
                                    <label for="user-image">Image</label>
                                    <input class="input" name="image" type="text" id="user-image"
                                        placeholder="Enter your image" title="Required image" required>
                                </div>
                                <div class="field">
                                    <div class="button-naja">
                                        <button type="submit" class="submit-button" id="submit">Submit</button>
                                        <button type="reset" class="cancel-button" id="cancel">Cancel</button>
                                    </div>
                                </div>
                            </form>

                            <!-- END of username and email-->
                        </div>
                        <!-- END of info of content-->
                    </div>
                    <!-- END of content in popup -->
                </div>
                <!-- END of popup -->
                <button class="add-btn" id="open">Add User</button>
            </div>
            <!-- END of part2 -->

            <!-- START OF PART3: ADMIN TABLE -->
            <div class="part3">
                <h4 class="title">ASAP Org.</h4>
                <table class="user-table">
                    <thead>
                        <tr class="table-title">
                            <th id="title-username">Username</th>
                            <th id="title-fname">First Name</th>
                            <th id="title-lname">Last Name</th>
                            <th id="title-position">Position</th>
                            <th id="title-phone">Phone Number</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="user-raw">
                            <td class="user">
                                <div class="table-img">
                                </div>
                                <div class="username">
                                </div>
                            </td>
                            <td class="fname"></td>
                            <td class="lname"></td>
                            <td class="position"></td>
                            <td class="phonenumber"></td>
                            <td class="table-button">
                                <button class="edit-table-btn" id="edit-btn">
                                </button>
                                <button class="delete-table-btn" id="delete-btn">
                                </button>
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>
            <!-- END OF PART3: ADMIN TABLE -->

            <!-- DELETE USER POPUP -->
            <div class="popup" id="popup-3">
                <div class="overlay"></div>
                <div class="content">
                    <div class="info" id="infodel">
                        <h2>Are you sure you want to delete this admin?</h2>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="submit-button" id="confirmDelete">Confirm</button>
                        <button type="reset" class="cancel-button" id="delete-cancel">Cancel</button>
                    </div>
                </div>
            </div>
            <!-- ADD USER POPUP -->
            <div class="popup" id="popup-1">
                <div class="overlay"></div>
                <div class="content">
                    <div class="info" id="infodel">
                        <h2>Add successful</h2>
                    </div>
                </div>
            </div>

            <!-- EDIT USER POPUP -->
            <div class="popup" id="popup-2">
                <div class="overlay"></div>
                <div class="content">
                    <div class="triangle"></div>
                    <div class="info" id="infoid">
                        <form action="" method="GET" class="form-card">
                            <div class="card_header">
                                <h1 class="form_heading">Edit User Account</h1>
                            </div>
                            <div class="field">
                                <label for="text">Username</label>
                                <input class="input" name="Username" type="text" id="Username"
                                    placeholder="Enter your email address" title="Required Email" required>
                            </div>
                            <div class="field">
                                <label for="text">First Name</label>
                                <input class="input" name="First-name" type="text" id="First-name"
                                    placeholder="Enter your first name" title="Required first name" required>
                            </div>
                            <div class="field">
                                <label for="text">Last Name</label>
                                <input class="input" name="Last-name" type="text" id="Last-name"
                                    placeholder="Enter your last name" title="Required last name" required>
                            </div>
                            <div class="field">
                                <label for="text">Position</label>
                                <input class="input" name="Position" type="text" id="Position"
                                    placeholder="Enter your position" title="Required position" required>
                            </div>
                            <div class="field">
                                <label for="text">Phone Number</label>
                                <input class="input" name="phone-number" type="text" id="phone-number"
                                    placeholder="Enter your phone number" title="Required phone number" required>
                            </div>
                            <div class="field">
                                <label for="text">Image</label>
                                <input class="input" name="user-image" type="text" id="user-image"
                                    placeholder="Enter your image" title="Required image" required>
                            </div>
                            <div class="field">
                                <div class="button-naja">
                                    <button type="submit" class="submit-button" id="edit-submit">Submit</button>
                                    <button type="reset" class="cancel-button" id="edit-cancel">Cancel</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
        <!-- END of content -->
    </div>
    <!-- <script src="/js/admin.js"></script> -->
    <script>

        function ShowAdmin(data) {
            const adminTable = document.querySelector('.user-table tbody');
            // Clear existing content
            adminTable.innerHTML = '';
            data.forEach(admin => {
                // Create the admin row
                const row = document.createElement('tr');
                row.classList.add('user-raw');

                // Username cell
                const usernameCell = document.createElement('td');
                usernameCell.className = 'user';
                const usernameImgDiv = document.createElement('div');
                usernameImgDiv.className = 'table-img';
                const usernameImg = document.createElement('img');
                usernameImg.src = admin.admin_image;
                usernameImg.alt = '';
                usernameImg.className = 'product-image';
                const usernameDiv = document.createElement('div');
                usernameDiv.className = 'username';
                usernameDiv.textContent = admin.admin_username;
                usernameImgDiv.appendChild(usernameImg);
                usernameCell.appendChild(usernameImgDiv);
                usernameCell.appendChild(usernameDiv);
                row.appendChild(usernameCell);

                // First Name cell
                const fnameCell = document.createElement('td');
                fnameCell.className = 'fname';
                fnameCell.textContent = admin.admin_fname;
                row.appendChild(fnameCell);

                // Last Name cell
                const lnameCell = document.createElement('td');
                lnameCell.className = 'lname';
                lnameCell.textContent = admin.admin_lname;
                row.appendChild(lnameCell);

                // Position cell
                const positionCell = document.createElement('td');
                positionCell.className = 'position';
                positionCell.textContent = admin.admin_position;
                row.appendChild(positionCell);

                // Phone Number cell
                const phoneCell = document.createElement('td');
                phoneCell.className = 'phonenumber';
                phoneCell.textContent = admin.admin_phone_number;
                row.appendChild(phoneCell);

                // Action cell
                const actionCell = document.createElement('td');
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-table-btn';
                editBtn.innerHTML = '<span class="material-symbols-outlined">edit</span>';
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-table-btn';
                deleteBtn.innerHTML = '<span class="material-symbols-outlined">delete</span>';
                actionCell.appendChild(editBtn);
                actionCell.appendChild(deleteBtn);
                row.appendChild(actionCell);
                // Add row to the table
                adminTable.appendChild(row);

                // Event Listener for Edit button
                editBtn.addEventListener('click', function () {
                    document.getElementById("popup-2").classList.add("active");
                });
                editBtn.addEventListener('click', function () {
                    document.getElementById("popup-1").classList.add("active");
                });

                // Event Listener for Delete button
                deleteBtn.addEventListener('click', function () {
                    const username = admin.admin_username; // Get the username
                    const deletePopup = document.getElementById("popup-3");
                    deletePopup.classList.add("active");

                    const confirmDeleteBtn = document.getElementById("confirmDelete");
                    confirmDeleteBtn.addEventListener('click', function () {
                        fetch(`http://localhost:8000/delete_user?username=${username}`, {
                            method: 'DELETE'
                        })
                            .then(response => {
                                if (response.ok) {
                                    console.log(`User with username ${username} deleted successfully.`);
                                    // After successful deletion, fetch updated user data
                                    fetch('http://localhost:8000/admin-account')
                                        .then(response => response.json())
                                        .then(data => {
                                            ShowAdmin(data); // Pass the data to ShowAdmin function
                                        })
                                        .catch(error => console.error('Error:', error));
                                } else {
                                    console.error(`Failed to delete user with username ${username}.`);
                                }
                                // Hide the delete confirmation popup regardless of the response
                                deletePopup.classList.remove("active");
                            })
                            .catch(error => {
                                console.error('Error deleting user:', error);
                                // Hide the delete confirmation popup in case of an error
                                deletePopup.classList.remove("active");
                            });
                    });
                });
            });
        }

        fetch('http://localhost:8000/admin-account')
            .then(response => response.json())
            .then(data => {
                ShowAdmin(data); // Pass the data to ShowAdmin function
            })
            .catch(error => console.error('Error:', error));

        const editCancelBtn = document.getElementById("edit-cancel");
        editCancelBtn.onclick = function removePopupEdit() {
            const editPopup = document.getElementById("popup-2");
            editPopup.classList.remove("active");
        }

        const deleteCancelBtn = document.getElementById("delete-cancel");
        deleteCancelBtn.onclick = function removePopupDelete() {
            const deletePopup = document.getElementById("popup-3");
            deletePopup.classList.remove("active");
        }

        let add_popup = document.getElementById("popup-1");
        addBtn.onclick = function togglePopup() {
            add_popup.classList.toggle("active");
        }
        cancelBtn.onclick = function removePopup() {
            add_popup.classList.remove("active");
        }


        window.onclick = function (e) {
            if (e.target.id != "open" &&
                e.target.classList == "overlay"
            ) {
                add_popup.classList.remove("active");
            }
        }

        function addAdmin(formData) {
            fetch("http://localhost:8000/add_admin", {
                method: "POST",
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    console.log("New admin added successfully.");
                    // After successful addition, fetch updated admin data
                    fetch('http://localhost:8000/admin-account')
                        .then(response => response.json())
                        .then(data => {
                            ShowAdmin(data); // Pass the data to ShowAdmin function
                        })
                        .catch(error => console.error('Error:', error));
                })
                .catch(error => console.error("Error:", error));
        }

        document.getElementById("add-admin-form").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(this);
            addAdmin(formData);
        });


    </script>

</body>

</html>